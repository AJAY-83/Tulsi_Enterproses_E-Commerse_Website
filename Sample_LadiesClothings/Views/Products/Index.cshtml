@model IEnumerable<Sample_LadiesClothings.Models.Product>
@{
    ViewData["Title"] = "Products";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="mb-4 fw-bold text-center">Our Latest Collections</h2>

<!-- 🔹 Slider Section (Top of page) -->
<div id="topProductsCarousel" class="carousel slide mb-5 shadow rounded-4 overflow-hidden" data-bs-ride="carousel">
    <div class="carousel-inner">
        @* Show 5 most sold products *@
        @{
            var topProducts = (List<Sample_LadiesClothings.Models.Product>)ViewBag.FeaturedProducts;
            int index = 0;
        }
        @foreach (var product in topProducts)
        {
            var images = !string.IsNullOrEmpty(product.Product_Image) 
                        ? product.Product_Image.Split(',')
                        : new string[] { "noimage.png" };

            <div class="carousel-item @(index == 0 ? "active" : "")">
                <img src="~/Product_Images/@images[0]" class="d-block w-100" 
                     style="height:400px; object-fit:cover; filter: brightness(0.7);" />
                <div class="carousel-caption d-flex flex-column justify-content-center align-items-center">
                    <h3 class="fw-bold text-white">@product.Product_Name</h3>
                    <p class="fw-semibold fs-5">₹ @product.Product_Price</p>
                    <a href="/Products/Details/@product.Product_Id" class="btn btn-light rounded-pill shadow px-4">
                        🛒 Shop Now
                    </a>
                </div>
            </div>
            index++;
        }
    </div>

    <!-- Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#topProductsCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#topProductsCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>

<!-- 🔹 Search and Filter Form -->
<form method="get" class="row g-3 align-items-end mb-4 bg-light p-3 rounded shadow-sm">
    <div class="col-12 col-md-4">
        <label class="form-label fw-semibold">Search</label>
        <input type="text" name="q" value="@ViewBag.Search" class="form-control" placeholder="Search products..." />
    </div>
    <div class="col-12 col-md-4">
        <label class="form-label fw-semibold">Category</label>
        <select class="form-select" name="categoryId">
            <option value="">All</option>
            @foreach (var c in (IEnumerable<Sample_LadiesClothings.Models.Category>)ViewBag.Categories)
            {
                if (ViewBag.CategoryId == c.Category_Id)
                {
                    <option value="@c.Category_Id" selected>@c.Category_Name</option>
                }
                else
                {
                    <option value="@c.Category_Id">@c.Category_Name</option>
                }
            }
        </select>
    </div>
    <div class="col-12 col-md-4">
        <button class="btn btn-dark w-100 rounded-pill shadow-sm">Filter</button>
    </div>
</form>

<!-- 🔹 Product Grid -->
<div class="row g-4">
    @foreach (var p in Model)
    {
        <div class="col-6 col-md-4 col-lg-3">
            <div class="card h-100 p-2 border-0 shadow-sm rounded-4 hover-shadow transition">
                <div class="position-relative overflow-hidden">
                    @if (!string.IsNullOrEmpty(p.Product_Image))
                    {
                        var images = p.Product_Image.Split(',');
                        <img src="~/Product_Images/@images[0]"
                             class="card-img-top product-img rounded-3"
                             style="height:220px; object-fit:cover;" />
                    }
                    else
                    {
                        <img src="~/Product_Images/noimage.png"
                             class="card-img-top rounded-3"
                             style="height:220px; object-fit:cover;" />
                    }
                </div>
                <div class="card-body text-center">
                    <h6 class="card-title fw-semibold mb-1">@p.Product_Name</h6>
                    <div class="small text-muted mb-1">
                        @(((IEnumerable<Sample_LadiesClothings.Models.Category>)ViewBag.Categories)
                                            .FirstOrDefault(x => x.Category_Id == p.Category_Id)?.Category_Name)
                    </div>
                    <div class="fw-bold mt-1 text-success fs-5">₹ @p.Product_Price</div>
                </div>
                <div class="p-2">
                    <a href="/Products/Details/@p.Product_Id" class="btn btn-dark w-100 rounded-pill shadow-sm hover-zoom">View Details</a>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <style>
        .carousel-caption {
            bottom: 20%;
        }
        .hover-shadow:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .transition {
            transition: all 0.3s ease;
        }
        .hover-zoom:hover {
            transform: scale(1.02);
        }
    </style>
}
